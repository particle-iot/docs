{
  "type": "libraries",
  "id": "UbidotsMQTT",
  "links": {
    "download": "https://api.particle.io/v1/libraries/UbidotsMQTT/archive/1.1.3.tar.gz"
  },
  "attributes": {
    "name": "UbidotsMQTT",
    "version": "1.1.3",
    "installs": 19522,
    "license": "MIT",
    "author": "Ubidots <devel@ubidots.com>, Jose Garcia <jose.garcia@ubidots.com>",
    "maintainer": "Jose Garc√≠a <jose.garcia@ubidots.com>",
    "sentence": "Ubidots MQTT library for Particle",
    "url": "https://github.com/ubidots/ubidots-particle-mqtt",
    "architectures": [],
    "visibility": "public",
    "mine": false
  },
  "kind": "community library",
  "letter": "u",
  "cardUrl": "/cards/libraries/u/UbidotsMQTT",
  "versions": {
    "1.1.3": {
      "builds": {
        "2.0.1": {
          "photon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "electron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "argon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "boron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          }
        },
        "1.5.2": {
          "photon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "electron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "argon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "boron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          }
        },
        "3.3.0": {
          "photon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "electron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "argon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "boron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          }
        },
        "5.0.1": {
          "argon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "boron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "bsom": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "b5som": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "tracker": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "p2": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          }
        },
        "4.0.0": {
          "argon": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "boron": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "bsom": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "b5som": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "tracker": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          },
          "esomx": {
            "UbidotsPublish": true,
            "UbidotsPublishContext": true,
            "UbidotsPublishTimestamp": true,
            "UbidotsSubscribe": true
          }
        }
      },
      "added": "2022-06-17T10:16:53.725Z"
    }
  },
  "readme": "# Ubidots MQTT library for Particle Devices\n\nThis library is based on the MQTT library for Spark Core made by Hirotakaster which is one of the most popular libraries for MQTT in the Particle environment. We had to make a small modification on line 121 in the MQTT.h file. When trying to wrapp up the library a memory allocation for IP address is not erased properly, so in order to fix it, we've declared as NULL and hence avoids taking a random value. Additionally, some guards were added.\n\nIn a few lines you should be able to publish or subscribe to Ubidots devices and variables.\n\n## Requirements\n\n* [Particle Core, Photon or Electron](https://store.particle.io/).\n* Micro USB cable.\n* Internet connection.\n\n## Setup\n\n1. Setting up your Particle device:\n    - If you are using a Particle Electron, please follow these steps to set up the Particle data plan. [Particle Electron steps](https://setup.particle.io/).\n    - If you are using a Particle Core you have two ways to set it up:\n        - [Using your smart phone](https://docs.particle.io/guide/getting-started/start/core/).\n        - [Connecting it to your computer over USB](https://docs.particle.io/guide/getting-started/connect/core/).\n    - If you are using a Particle Photon you have two ways to set it up:\n        - [Using your smart phone](https://docs.particle.io/guide/getting-started/start/Photon/).\n        - [Connecting it to your computer over USB](https://docs.particle.io/guide/getting-started/connect/Photon/).\n\n2. After claiming your Particle Device and setting up your Ubidots account, head to [Particle's Web IDE](https://build.particle.io/build).\n    * In the Particle's Web IDE create a new app and set the name.\n    * Go to the library tab.\n    * Search \"Ubidots\" and select the UbidotsMQTT library.\n    * Click on **INCLUDE IN APP**. And return to your app.   \n\n# Documentation\n\n## Constructor\n\n### Ubidots\n```\nUbidots(char* token, void (*callback)(char*, uint8_t*, unsigned int))\n```\n> @token, [Required]. Your Ubidots unique account [TOKEN](http://help.ubidots.com/user-guides/find-your-token-from-your-ubidots-account).\n@callback, [Required]. the callback function must be declared even though you don't need to subscribe to any variable, so the below code line should always be in your scripts:\n```cpp\nvoid callback(char* topic, byte* payload, unsigned int length);\n```\n\nCreates an instance to connect tu Ubidots' broker. Default broker is `industrial.api.ubidots.com`. If you're using Ubidots for Education platform broker `things.ubidots.com`, use the `setBroker()` method explained below.\n\n# Methods to send data\n\n### add\n```\nvoid add(char* variableLabel, float value, char *context, char *dotTimestamp, uint16_t dotTimestampMillis);\n```\n> @variableLabel, [Required]. The label of the variable where the dot will be stored.\n@value, [Required]. The value of the dot.  \n@context, [Optional]. The dot's context.  \n@dot_timestamp_seconds, [Optional]. The dot's timestamp in seconds.  \n@dot_timestamp_millis, [Optional]. The dot's timestamp number of milliseconds. If the timestamp's milliseconds values is not set, the seconds will be multplied by 1000.\n\nAdds a dot with its value, context and timestamp to be sent in the payload. You can add up to 5 dots before publishing them to Ubidots. \n## ubidotsPublish\n```\nbool ubidotsPublish(char *deviceLabel);\n```\n> @deviceLabel, [Optional], [Defaults] = PARTICLE_DEVICE_ID. Device label to publish data to in Ubidots.\n\nSends all the data added using the add() method. Returns true if the data was sent. \n\n# Method to retrieve data\n\n## ubidotsSubscribe\n```\nubidotsSubscribe(char* deviceLabel, char* variableLabel);\n```\n> @deviceLabel, [Required]. The device label which contains the variable to retrieve values from.\n@variableLabel, [Required]. The variable label to retrieve the last value from.\n\nSubscribe to the specified device label and variable label of your Ubidots account.\n\n# Auxiliar methods\n\n## addContext\n```\nvoid addContext(char* keyLabel, char* keyValue);\n```\n> @keyLabel, [Required]. The key context label to store values.  \n@keyValue, [Required]. The key pair value. \n\nAdds to local memory a new key-value context key. The method inputs must be char pointers. The method allows to store up to 10 key-value pairs.\n## getContext\n```\nvoid getContext(char *contextResult);\n```\n> @contextResult, [Required]. A char pointer where the context will be stored.\n\nBuilds the context according to the chosen protocol and stores it in the contextResult char pointer.\n## connect\n```\nbool connect(uint8_t maxRetries);\n```\n> @maxRetries [Optional], [Default] = 0. Max retries is 255.\n\nIndicates the number of times the method will attempt to connect to Ubidots' broker.\n## loop\n```\nloop();\n```\n> Infinite loop for MQTT connection, insert it at the end of your routine.\n## isConnected\n```\nbool isConnected();\n```\n> Returns `true` if there's an open socket socket with the broker, `false` otherwise.\n## ubidotsSetBroker\n```\nvoid ubidotsSetBroker(char *broker, uint16_t port);\n```\n> @broker, [Required]. Broker DNS to connect to.\n@port, [Optional], [Defaults] = 1883. TCP port used to open the socket \n\nSets the broker properly to publish and subscribe to Ubidots accounts. If your account is an Industrial one,set \"industrial.api.ubidots.com\". By default, broker will be set to publish and subscribe to \"industrial.api.ubidots.com\". Use \"things.ubidots.com\" for Ubidots for Education free version platform.\n## setDebug\n```\nvoid ubidotsSetDebug(bool debug);\n```\n> @debug, [Required]. Boolean type to turn off/on debug messages.\n\nMake debug messages available through the serial port.\n\n# Examples\n\nRefer to the examples folder\n\n## Subscribe to a variable\n\nTo subscribe to a variable, you need to specify your device and variable lables as input arguments for the ubidotsSubscribe() function. The incoming value will be returned by the MQTT library in the payload variable, by default the subscribed function only gets the last value of the variable subscribed. Retain value feature is only available for business users.\n\n```cpp\n/****************************************\n * Include Libraries\n ****************************************/\n\n#include \"UbidotsMQTT.h\"\n\n/****************************************\n * Define Constants\n ****************************************/\n\n#ifndef TOKEN\n#define TOKEN \"Your TOKEN\"  // Add here your Ubidots TOKEN\n#endif\n\n\n/****************************************\n * Auxiliar Functions\n ****************************************/\n\nvoid callback(char* topic, byte* payload, unsigned int length) {\n    Serial.print(\"Message arrived [\");\n    Serial.print(topic);\n    Serial.print(\"] \");\n    Serial.println(\"payload obtained from server:\");\n    for (int i=0;i<length;i++) {\n        Serial.print((char)payload[i]); // prints the answer of the broker for debug purpose\n    }\n    // Some stuff to make with the payload obtained\n        //\n   //\n    Serial.println();\n}\n\n/****************************************\n * Instances\n ****************************************/\n\nUbidots client(TOKEN, callback);\n\n/****************************************\n * Main Functions\n ****************************************/\n\nvoid setup() {\n    Serial.begin(115200);\n    client.initialize();\n\n    // Uncomment this line if you have a business Ubidots account\n    //client.ubidotsSetBroker(\"business.api.ubidots.com\");\n\n    if(client.isConnected()){\n        // Insert as first parameter the device to subscribe and as second the variable label\n        client.ubidotsSubscribe(\"device-to-subscribe\", \"water-level\"); \n    }\n}\n\nvoid loop() {\n    if(!client.isConnected()){\n        client.reconnect();\n    }\n\n    // Client loop for publishing and to maintain the connection\n    client.loop();\n    delay(1000);\n}\n\n```\n\n## Publish values to a device\n\nTo publish values to Ubidots, you have to call first the add() function first for storing the values to send (max of 5 values per request), so insert as parameters for the add() function the variable label, the context and the timestamp (these last two are optionals):\n\n```cpp\n/****************************************\n * Include Libraries\n ****************************************/\n\n#include \"UbidotsMQTT.h\"\n\n/****************************************\n * Define Constants\n ****************************************/\n\n#ifndef TOKEN\n#define TOKEN \"Your TOKEN\"  // Add here your Ubidots TOKEN\n#endif\n\n\n/****************************************\n * Auxiliar Functions\n ****************************************/\n\nvoid callback(char* topic, byte* payload, unsigned int length) {\n    Serial.print(\"Message arrived [\");\n    Serial.print(topic);\n    Serial.print(\"] \");\n    Serial.println(\"payload obtained from server:\");\n    for (int i=0;i<length;i++) {\n        Serial.print((char)payload[i]); // prints the answer of the broker for debug purpose\n    }\n    // Some stuff to make with the payload obtained\n        //\n   //\n    Serial.println();\n}\n\n\n/****************************************\n * Instances\n ****************************************/\n\nUbidots client(TOKEN, callback);\n\n/****************************************\n * Main Functions\n ****************************************/\n\nvoid setup() {\n    Serial.begin(115200);\n    client.initialize();\n\n    // Uncomment this line if you have a business Ubidots account\n    //client.ubidotsSetBroker(\"business.api.ubidots.com\");\n}\n\nvoid loop() {\n    if(!client.isConnected()){\n        client.reconnect();\n    }\n\n    // Publish routine, if the device and variables are not created they will be created\n    float value = 1;\n    Serial.println(\"Sending value\");\n    client.add(\"test-var-1\", value); // Insert as first parameter your variable label\n    client.add(\"test-var-2\", value, \"\\\"lat\\\":10.302, \\\"lng\\\":2.9384\"); //Adds value with context\n    client.add(\"test-var-3\", value, NULL, 1492445109); // Adds value with custom timestamp\n    client.ubidotsPublish(\"test-device\"); // Insert your device label where the values will be stored in Ubidots\n\n    // Client loop for publishing and to maintain the connection\n    client.loop();\n    delay(1000);\n}\n```",
  "allVersions": [
    "1.1.3",
    "1.1.2",
    "1.1.0",
    "1.0.0"
  ]
}